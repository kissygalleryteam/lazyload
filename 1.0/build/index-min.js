/*!build time : 2014-03-22 8:20:36 PM*/
KISSY.add("gallery/datalazyload/1.0/index",function(a,b){function c(b){var c=this,e=a.merge(h,b),g=function(){c._loadElement()};c.container=f(e.container),c.config=e,c._loadFn=d(g,e.duration,c),c._containerIsNotDocument=9!=c.container[0].nodeType,c.lazyElements=c.__filterLazyElements(),c.resume(),c._loadElement()}function d(a,b,c){function d(){d.stop(),f=e(a,b,0,c||this,arguments)}if(b=b||150,-1===b)return function(){a.apply(c||this,arguments)};var f=null;return d.stop=function(){f&&(f.cancel(),f=0)},d}function e(b,c,d,e,f){c=c||0;var g,h,i=b,j=a.makeArray(f);return"string"==typeof b&&(i=e[b]),i||a.error("method undefined"),g=function(){i.apply(e,j)},h=d?setInterval(g,c):setTimeout(g,c),{id:h,interval:d,cancel:function(){this.interval?clearInterval(h):clearTimeout(h)}}}var f=b.all,g=window,h={threshold:0,event:"scroll touchmove resize",effect:"show",container:document,attribute:"data-ks-lazyload",duration:300,load:null,complete:null};return c.prototype={_loadElement:function(){var a=this,b=a.config.complete,c=a.container,d=a.lazyElements;if(!a._containerIsNotDocument||c.offset().width){for(var e=0;e<d.length;e++){var f=d[e];a.__inViewport(f)&&(a.__renderElement(f),d.splice(e--,1))}d.length<1&&(b&&"function"==typeof b&&b.call(this),a.destroy())}},__filterLazyElements:function(){var a=this,b=a.config,c=a.container,d=c.all("["+b.attribute+"]");return Array.prototype.slice.call(d)},refresh:function(){this.__filterLazyElements()},pause:function(){var a=this,b=a.config.event,c=a._loadFn;a._destroyed||(f(g).detach(b,c),a._containerIsNotDocument&&a.container.detach(b,c))},resume:function(){var a=this,b=a.config.event,c=a._loadFn;a._destroyed||(f(g).on(b,c),a._containerIsNotDocument&&a.container.on(b,c))},__inViewport:function(a){var b,c,d,e,h=this,i=!h._containerIsNotDocument,j=h.container,k=i?null:f(j).offset(),l=f(a).offset(),m=h.config.threshold;if(i){var n=g.innerWidth,o=g.innerHeight,p=g.scrollX,q=g.scrollY;b=o+q<=l.top-m,c=n+p<=l.left-m,d=q>=l.top+a.offsetHeight+m,e=p>l.left+a.offsetWidth+m}else{var r=j.scrollTop(),s=j.scrollLeft(),n=j.width(),o=j.height();b=r+o<=r+l.top-k.top+m,c=s+n<=s+l.left-k.left+m,d=r>=r+(l.top-k.top)+a.offsetHeight-m,e=s>=s+(l.left-k.left)+a.offsetWidth-m}return!(b||c||d||e)},__renderElement:function(a){var b=this,c=b.config,d=f(a),e=a.nodeName.toUpperCase(),g=c.attribute,h=c.load;if("IMG"==e){var i=d.attr(g);d.attr("src",i)}else{if("TEXTAREA"!=e)return;var j=d.val(),k=f("<div/>");k.html(j,!0).insertBefore(d),d.hide()}"function"==typeof h&&h.call(this,a)},destroy:function(){var b=this;b.pause(),a.log("datalazyload is destroyed!")}},c},{requires:["node"]});